apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ./persistent_image_cache.yml
- ./../../manifests/
namespace: staging

patches:
  # Don't deploy the backup CronJob in staging
  - target:
      kind: CronJob
      name: add-todo-db-backup-cronjob
    patch: |
      $patch: delete
      apiVersion: batch/v1
      kind: CronJob
      metadata:
        name: add-todo-db-backup-cronjob
  # Use separate StorageClass for image-cache PVC in staging
  - target:
      kind: PersistentVolume
      name: image-cache-vol
    patch: |
      $patch: delete
      apiVersion: v1
      kind: PersistentVolume
      metadata:
        name: image-cache-vol
  - target:
      kind: PersistentVolumeClaim
      name: image-cache
    patch: |
      apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: image-cache
      spec:
        storageClassName: staging-image-cache-vol
